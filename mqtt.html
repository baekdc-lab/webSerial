<!-- ê¸°ì¡´ í—¤ë” ì˜¤ë¥¸ìª½ì— 'Wi-Fi' ë²„íŠ¼ê³¼ ëª¨ë‹¬ì„ ì†Œí­ ì¶”ê°€ -->
<!-- â€¦(head, style ê¸°ì¡´ ê·¸ëŒ€ë¡œ)â€¦ -->

<!-- [ì¶”ê°€ëœ ìŠ¤íƒ€ì¼] -->
<style>
/* â€¦ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€â€¦ */
.top-actions{display:flex;gap:8px;align-items:center}
.btn.wifi{background:var(--btn-bg);border:1px solid var(--btn-border);color:var(--txt);padding:8px 10px;border-radius:10px;cursor:pointer;font-weight:800}

/* Modal */
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:999}
.modal{background:var(--card);border-radius:14px;padding:16px;min-width:260px;max-width:90vw;box-shadow:0 10px 30px rgba(0,0,0,.35)}
.modal h3{margin:0 0 10px}
.modal .row{display:flex;flex-direction:column;gap:6px;margin:8px 0}
.modal input{background:transparent;border:1px solid var(--btn-border);color:var(--txt);padding:10px;border-radius:10px;outline:none}
.modal .acts{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
.modal .acts .btn{min-width:auto;padding:10px 12px}
.modal.show{display:flex}
</style>

<body>
<div class="wrap"><div class="card">
  <h1>ESP32 ì„¼ì„œ ëŒ€ì‹œë³´ë“œ
    <span class="top-actions">
      <button id="btnWifi" class="btn wifi">Wi-Fi</button>
      <span class="theme-toggle" id="themeToggle">ğŸŒ™</span>
    </span>
  </h1>
  <p class="mut">AHT25(ì˜¨/ìŠµ) + SCD42(ì˜¨/ìŠµ/COâ‚‚) Â· LEDì œì–´</p>

  <!-- â€¦ê¸°ì¡´ ë³¸ë¬¸ ê·¸ëŒ€ë¡œâ€¦ -->

  <!-- [Modal: Wi-Fi ì—°ê²°] -->
  <div id="wifiModal" class="modal-backdrop">
    <div class="modal">
      <h3>Wi-Fi ì—°ê²°</h3>
      <div class="row">
        <label>SSID</label>
        <input id="inSsid" placeholder="ë„¤íŠ¸ì›Œí¬ ì´ë¦„">
      </div>
      <div class="row">
        <label>ë¹„ë°€ë²ˆí˜¸</label>
        <input id="inPw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸(í•„ìš” ì‹œ)">
      </div>
      <div id="wifiHint" class="mut">í˜„ì¬ ìƒíƒœ í™•ì¸ ì¤‘â€¦</div>
      <div class="acts">
        <button class="btn dim" id="wifiCancel">ì·¨ì†Œ</button>
        <button class="btn on"  id="wifiConnect">ì—°ê²°</button>
      </div>
    </div>
  </div>

</div></div>

<script>
/* ===== ê¸°ì¡´ ìŠ¤í¬ë¦½íŠ¸ ìƒë‹¨/ë³€ìˆ˜/í•¨ìˆ˜ëŠ” ê·¸ëŒ€ë¡œâ€¦ ===== */
/* (ì—¬ê¸°ì„œëŠ” Wi-Fi ëª¨ë‹¬ ê´€ë ¨ ì½”ë“œë§Œ ì¶”ê°€í•©ë‹ˆë‹¤) */

// --- Wi-Fi Modal í•¸ë“¤ëŸ¬ ---
const mBackdrop = document.getElementById('wifiModal');
const btnWifi   = document.getElementById('btnWifi');
const inSsid    = document.getElementById('inSsid');
const inPw      = document.getElementById('inPw');
const btnWCancel= document.getElementById('wifiCancel');
const btnWConn  = document.getElementById('wifiConnect');
const wifiHint  = document.getElementById('wifiHint');

function openWifiModal(){
  mBackdrop.classList.add('show');
  fetch(BASE + '/api/wifi/status', {cache:'no-store'})
    .then(r=>r.json()).then(s=>{
      wifiHint.textContent = s.connected ? `ì—°ê²°ë¨: ${s.ssid} (${s.ip})` : 'ë¯¸ì—°ê²°';
      if(!s.connected && inSsid.value===''){ inSsid.focus(); }
    }).catch(_=>{ wifiHint.textContent='ìƒíƒœ ì¡°íšŒ ì‹¤íŒ¨'; });
}
function closeWifiModal(){
  mBackdrop.classList.remove('show');
}
btnWifi.onclick   = openWifiModal;
btnWCancel.onclick= closeWifiModal;
mBackdrop.addEventListener('click', (e)=>{ if(e.target===mBackdrop) closeWifiModal(); });

btnWConn.onclick = async ()=>{
  const ssid = inSsid.value.trim();
  const password = inPw.value;
  if(!ssid){ wifiHint.textContent='SSIDë¥¼ ì…ë ¥í•˜ì„¸ìš”.'; inSsid.focus(); return; }
  wifiHint.textContent='ì—°ê²° ì‹œë„ ì¤‘â€¦';
  try{
    const r = await fetch(BASE + '/api/wifi/connect', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ssid, password}),
    });
    const j = await r.json();
    if(j.ok){
      wifiHint.textContent = `ì—°ê²°ë¨: ${j.ssid} (${j.ip})`;
      // ì—°ê²°ë˜ë©´ ì„¼ì„œ/LED ìƒíƒœ ê°±ì‹ 
      refreshFast();
      setTimeout(closeWifiModal, 800);
    }else{
      wifiHint.textContent = 'ì—°ê²° ì‹¤íŒ¨. SSID/ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.';
    }
  }catch(e){
    wifiHint.textContent = 'ì—°ê²° ì˜¤ë¥˜: ' + e.message;
  }
};

/* ===== ì•„ë˜ë¡œ ê¸°ì¡´ ìŠ¤í¬ë¦½íŠ¸(í…Œë§ˆ í† ê¸€/í‘œ/ê·¸ë˜í”„/LED ë“±) ê·¸ëŒ€ë¡œ ìœ ì§€ ===== */
</script>
</body>
